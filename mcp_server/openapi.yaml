openapi: 3.1.0
info:
  title: mcp-hack API
  version: 1.0.0
  description: |
    MCP (Model Context Protocol) unified gateway server providing HTTP endpoints for various services.
    This server exposes tools for managing Slack, GitHub, Google Calendar, Gmail, and Google Sheets.
    
    The server supports elicitation for user confirmation on certain operations.
  contact:
    name: MCP Hack API Support
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC

servers:
  - url: https://mcp-hack.onrender.com
    description: Production server

security:
  - bearerAuth: []
  - apiKeyHeader: []

paths:
  /:
    get:
      operationId: getApiInfo
      summary: Get API information
      description: Returns basic information about the MCP HTTP test server
      tags:
        - info
      responses:
        '200':
          description: API information
          content:
            text/plain:
              schema:
                type: string
                example: |
                  MCP Gateway API
                  Available endpoints:
                  - GET  /tools -> List all available tools
                  - POST /call -> Generic tool execution
                  - POST /{tool_name} -> Direct tool execution
              examples:
                default:
                  value: |
                    MCP Gateway API
                    Available endpoints:
                    - GET  /tools -> List all available tools
                    - POST /call -> Generic tool execution
                    - POST /{tool_name} -> Direct tool execution

  # Generic tool endpoints
  /tools:
    get:
      operationId: listTools
      summary: List available tools
      description: Returns a list of all available MCP tools with their names and descriptions
      tags:
        - tools
      responses:
        '200':
          description: List of available tools
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tool'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /call:
    post:
      operationId: callTool
      summary: Execute an MCP tool
      description: |
        Execute a specific MCP tool by name with provided arguments.
        Supports operations across Slack, GitHub, Google Calendar, Gmail, and Google Sheets.
      tags:
        - tools
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToolCallRequest'
            examples:
              slack_post_message:
                summary: Post a Slack message
                value:
                  name: slack_post_message
                  arguments:
                    channel_id: C1234567890
                    text: Hello, World!
              google_sheets_read:
                summary: Read Google Sheet values
                value:
                  name: google_sheets_read
                  arguments:
                    user_google_email: user@example.com
                    spreadsheet_id: 1A2B3C4D...
                    range: "Sheet1!A1:D10"
      responses:
        '200':
          description: Tool execution result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolCallResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Slack endpoints
  /slack/list-channels:
    post:
      operationId: slack_list_channels
      summary: List Slack channels
      description: List public or pre-defined channels in the workspace with pagination
      tags:
        - slack
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                cursor:
                  type: string
                  description: Pagination cursor for the next set of results
                limit:
                  type: integer
                  description: Maximum number of channels to return
                  default: 100
      responses:
        '200':
          description: List of channels
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackChannelList'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /slack/post-message:
    post:
      operationId: slack_post_message
      summary: Post a message to Slack
      description: Post a new message to a Slack channel
      tags:
        - slack
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel_id, text]
              properties:
                channel_id:
                  type: string
                  description: The ID of the channel to post to
                text:
                  type: string
                  description: The message text
                blocks:
                  type: array
                  description: Message blocks (rich formatting)
                thread_ts:
                  type: string
                  description: Thread timestamp to reply to
      responses:
        '200':
          description: Message posted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackMessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # GitHub endpoints
  /github/create-repository:
    post:
      operationId: github_create_repository
      summary: Create a new GitHub repository
      description: Create a new GitHub repository
      tags:
        - github
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  description: Name of the new repository
                description:
                  type: string
                  description: Repository description
                private:
                  type: boolean
                  description: Whether the repository should be private
                  default: false
      responses:
        '201':
          description: Repository created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitHubRepository'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Google Sheets endpoints
  /google/sheets/list:
    post:
      operationId: google_sheets_list
      summary: List Google Sheets
      description: List spreadsheets from Google Drive that the user has access to
      tags:
        - google_sheets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_google_email]
              properties:
                user_google_email:
                  type: string
                  format: email
                  description: User's Google email
                max_results:
                  type: integer
                  description: Maximum number of results to return
                  default: 25
      responses:
        '200':
          description: List of spreadsheets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GoogleSheet'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /google/sheets/read:
    post:
      operationId: google_sheets_read
      summary: Read values from a Google Sheet
      description: Reads values from a specific range in a Google Sheet
      tags:
        - google_sheets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_google_email, spreadsheet_id]
              properties:
                user_google_email:
                  type: string
                  format: email
                  description: User's Google email
                spreadsheet_id:
                  type: string
                  description: ID of the spreadsheet
                range:
                  type: string
                  description: Range to read (e.g., "A1:B2", "Sheet1!A1:Z1000")
                  default: "A1:Z1000"
      responses:
        '200':
          description: Sheet values
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleSheetValues'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /google/sheets/modify:
    post:
      operationId: google_sheets_modify
      summary: Modify values in a Google Sheet
      description: Modifies values in a specific range of a Google Sheet
      tags:
        - google_sheets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_google_email, spreadsheet_id, range]
              properties:
                user_google_email:
                  type: string
                  format: email
                  description: User's Google email
                spreadsheet_id:
                  type: string
                  description: ID of the spreadsheet
                range:
                  type: string
                  description: Range to modify (e.g., "A1:B2", "Sheet1!A1")
                values:
                  type: array
                  items:
                    type: array
                    items:
                      type: any
                  description: 2D array of values to write
                value_input_option:
                  type: string
                  enum: [RAW, USER_ENTERED]
                  default: USER_ENTERED
                  description: How to interpret input values
                clear_values:
                  type: boolean
                  default: false
                  description: If true, clears the range instead of writing values
      responses:
        '200':
          description: Values modified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleSheetUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Google Calendar endpoints
  /google/calendar/list-calendars:
    post:
      operationId: google_calendar_list_calendars
      summary: List Google Calendars
      description: List all calendars accessible to the authenticated user
      tags:
        - google_calendar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_google_email]
              properties:
                user_google_email:
                  type: string
                  format: email
                  description: User's Google email
      responses:
        '200':
          description: List of calendars
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GoogleCalendar'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Gmail endpoints
  /gmail/search-messages:
    post:
      operationId: gmail_search_messages
      summary: Search Gmail messages
      description: Search for messages in Gmail
      tags:
        - gmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_google_email, query]
              properties:
                user_google_email:
                  type: string
                  format: email
                  description: User's Google email
                query:
                  type: string
                  description: Gmail search query
                max_results:
                  type: integer
                  description: Maximum number of results to return
                  default: 10
      responses:
        '200':
          description: List of matching messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GmailMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: Bearer token authentication for API access
    apiKeyHeader:
      type: apiKey
      in: header
      name: x-api-key
      description: API key authentication via custom header

  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              format: int32
              description: HTTP status code
            message:
              type: string
              description: Error message
            details:
              type: array
              items:
                type: object
              description: Additional error details
    
    ToolExecutionError:
      type: object
      properties:
        ok:
          type: boolean
          description: Indicates if the operation was successful
        error:
          type: string
          description: Error message or error code
    
    Tool:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          description: Unique identifier for the tool
          examples:
            - slack_post_message
            - github_create_repository
        description:
          type: string
          description: Human-readable description of what the tool does
          examples:
            - Post a new message to a Slack channel
            - Create a new GitHub repository

    ToolCallRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Name of the tool to execute
          examples:
            - slack_post_message
            - slack_list_channels
            - create_repository
            - get_file_contents
        arguments:
          type: object
          description: Tool-specific arguments
          additionalProperties: true
          examples:
            - channel_id: C1234567890
              text: Hello, World!
            - owner: octocat
              repo: Hello-World
              path: README.md

    ToolCallResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        result:
          type: object
          additionalProperties: true
          description: Result of the tool execution
        error:
          type: string
          description: Error message if status is error

    # Slack Schemas
    SlackChannel:
      type: object
      properties:
        id:
          type: string
          description: Channel ID
          examples:
            - C1234567890
        name:
          type: string
          description: Channel name
          examples:
            - general
            - random
        is_private:
          type: boolean
          description: Whether the channel is private
        is_archived:
          type: boolean
          description: Whether the channel is archived

    SlackChannelList:
      type: object
      properties:
        channels:
          type: array
          items:
            $ref: '#/components/schemas/SlackChannel'
        response_metadata:
          type: object
          properties:
            next_cursor:
              type: string
              description: Pagination cursor for the next page of results

    SlackMessageResponse:
      type: object
      properties:
        ok:
          type: boolean
          description: Whether the operation was successful
        channel:
          type: string
          description: Channel ID where the message was posted
        ts:
          type: string
          description: Timestamp of the message
        message:
          type: object
          additionalProperties: true
          description: Message object

    # GitHub Schemas
    GitHubRepository:
      type: object
      properties:
        id:
          type: integer
          description: Repository ID
        name:
          type: string
          description: Repository name
        full_name:
          type: string
          description: Full repository name (owner/repo)
        private:
          type: boolean
          description: Whether the repository is private
        html_url:
          type: string
          format: uri
          description: URL to the repository on GitHub
        description:
          type: string
          nullable: true
          description: Repository description
        fork:
          type: boolean
          description: Whether the repository is a fork
        url:
          type: string
          format: uri
          description: API URL for the repository

    # Google Sheets Schemas
    GoogleSheet:
      type: object
      properties:
        id:
          type: string
          description: The ID of the spreadsheet
        name:
          type: string
          description: The name of the spreadsheet
        modifiedTime:
          type: string
          format: date-time
          description: When the spreadsheet was last modified
        webViewLink:
          type: string
          format: uri
          description: URL to view the spreadsheet in a browser

    GoogleSheetValues:
      type: object
      properties:
        range:
          type: string
          description: The range the values cover
        majorDimension:
          type: string
          enum: [ROWS, COLUMNS]
          description: The major dimension of the values
        values:
          type: array
          items:
            type: array
            items:
              type: any
          description: The values in the range

    GoogleSheetUpdateResponse:
      type: object
      properties:
        spreadsheetId:
          type: string
          description: The ID of the spreadsheet
        updatedRange:
          type: string
          description: The range that was updated
        updatedRows:
          type: integer
          description: Number of rows updated
        updatedColumns:
          type: integer
          description: Number of columns updated
        updatedCells:
          type: integer
          description: Number of cells updated

    # Google Calendar Schemas
    GoogleCalendar:
      type: object
      properties:
        id:
          type: string
          description: Calendar ID
        summary:
          type: string
          description: Calendar name
        description:
          type: string
          nullable: true
          description: Calendar description
        timeZone:
          type: string
          description: Timezone of the calendar
        primary:
          type: boolean
          description: Whether this is the primary calendar
        accessRole:
          type: string
          description: User's access level to the calendar

    # Gmail Schemas
    GmailMessage:
      type: object
      properties:
        id:
          type: string
          description: Message ID
        threadId:
          type: string
          description: Thread ID
        labelIds:
          type: array
          items:
            type: string
          description: List of label IDs
        snippet:
          type: string
          description: A short part of the message text
        internalDate:
          type: string
          format: int64
          description: Internal date the message was received

  responses:
    BadRequest:
      description: Bad request - The request was invalid or cannot be served
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized - Authentication is required and has failed or has not been provided
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden - The request was valid but the server is refusing action
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not Found - The requested resource could not be found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Internal Server Error - An unexpected error occurred
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: info
    description: API information and health endpoints
  - name: mcp
    description: Model Context Protocol tool operations
  - name: slack
    description: Slack integration operations
  - name: github
    description: GitHub integration operations

externalDocs:
  description: Model Context Protocol Documentation
  url: https://modelcontextprotocol.io/docs
